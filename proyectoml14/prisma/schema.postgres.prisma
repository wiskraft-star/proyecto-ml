generator client { provider = "prisma-client-js" }

datasource db { provider = "postgresql" url = env("DATABASE_URL") }

model Sale {
  id         String     @id @default(uuid())
  economicId String     @unique
  orderId    String?    @index
  packId     String?    @index
  date       DateTime
  status     String
  items      SaleItem[]
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt
}

model SaleItem {
  id     String @id @default(uuid())
  saleId String
  sale   Sale   @relation(fields: [saleId], references: [id], onDelete: Cascade)

  sku   String @index
  title String?
  qty   Int

  @@index([saleId])
}

model Payment {
  id          String   @id @default(uuid())
  economicId  String?  @index
  orderId     String?
  packId      String?
  mpPaymentId String?  @unique
  netAmount   Decimal  @db.Numeric(18,4)
  grossAmount Decimal? @db.Numeric(18,4)
  feesAmount  Decimal? @db.Numeric(18,4)
  paidAt      DateTime?
  sourceRaw   Json
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model SkuCost {
  sku       String   @id
  unitCost  Decimal  @db.Numeric(18,4)
  updatedAt DateTime @updatedAt
}

model Supply {
  id        String  @id @default(uuid())
  name      String  @unique
  unitCost  Decimal @db.Numeric(18,4)
  recipe    SupplyRecipeLine?
  updatedAt DateTime @updatedAt
}

model SupplyRecipeLine {
  id         String  @id @default(uuid())
  supplyId   String  @unique
  supply     Supply  @relation(fields: [supplyId], references: [id], onDelete: Cascade)
  qtyPerSale Decimal @db.Numeric(18,6)
  updatedAt  DateTime @updatedAt
}

model AppSetting {
  id         String   @id @default(uuid())
  mlSellerId String?
  mlSiteId   String   @default("MLA")
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}
